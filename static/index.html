
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Minecraft Hardcore Night</title>
    <style>
        body { font-family: 'Segoe UI', monospace; background: #0d0d0d; color: #eee; text-align: center; }
        canvas { background: #1b261b; border: 4px solid #3e2723; margin-top: 10px; box-shadow: 0 0 30px rgba(0,0,0,0.7); }
        .panel { background: #212121; padding: 10px; display: inline-block; border: 1px solid #424242; border-radius: 8px; margin-bottom: 5px; min-width: 800px; }
        b { color: #ffca28; }
        .stat { margin: 0 10px; font-size: 14px; }
        .legend { font-size: 12px; color: #aaa; margin-top: 5px; }
        input[type=range] { vertical-align: middle; accent-color: #d84315; }
    </style>
</head>
<body>
    <div class="panel">
        <span class="stat">üìÖ D√≠a: <b id="dia">1</b></span> | 
        <span class="stat">üíÄ Amenaza: <b id="threat" style="color:#ef5350">0</b></span> |
        <span class="stat">üë• Vivos: <b id="pob">0</b></span> |
        <span class="stat">üßü Horda: <b id="zom">0</b></span> |
        <span class="stat">‚ôªÔ∏è Respawn: <b style="color:#00e676">DIARIO</b></span>
        <br><br>
        <label>‚è© Velocidad:</label> <input type="range" id="slider" min="1" max="50" value="1">
    </div>

    <canvas id="simCanvas" width="1000" height="700"></canvas>

    <div class="legend">
        üî¥ Comida | üü§ Madera | ‚ö™ Piedra | 
        <span style="color:#ff9800">üè† Casa</span> | <span style="color:#29b6f6">Steve</span>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const ANCHO = 1000, ALTO = 700;

        function draw(data) {
            ctx.fillStyle = data.is_night ? "#05040a" : "#2e7d32"; // Noche m√°s oscura
            ctx.fillRect(0, 0, ANCHO, ALTO);

            // Recursos
            data.recursos.forEach(r => {
                if(r.type === 'food') { 
                    ctx.fillStyle = '#ff1744'; ctx.beginPath(); ctx.arc(r.x, r.y, 4, 0, Math.PI*2); ctx.fill(); 
                } else {
                    ctx.fillStyle = (r.type === 'wood') ? '#795548' : '#bdbdbd'; 
                    ctx.fillRect(r.x-3, r.y-3, 7, 7);
                }
            });

            // Casas
            data.casas.forEach(h => {
                let size = 16 + (h.lvl * 6);
                ctx.fillStyle = h.lvl === 3 ? "#bf360c" : (h.lvl === 2 ? "#e65100" : "#ff9800");
                ctx.fillRect(h.x - size/2, h.y - size/2, size, size);
                // Barra HP Casa
                ctx.fillStyle = "black"; ctx.fillRect(h.x - size/2, h.y - size/2 - 6, size, 4);
                ctx.fillStyle = "#00e676"; ctx.fillRect(h.x - size/2, h.y - size/2 - 6, size * (h.hp/h.max_hp), 4);
                // Ocupantes
                ctx.fillStyle = "white"; ctx.font = "10px monospace";
                ctx.fillText(h.occupants + "/" + h.cap, h.x - 10, h.y + 4);
            });

            // Steves
            data.steves.forEach(p => {
                ctx.beginPath();
                ctx.fillStyle = "#29b6f6"; 
                ctx.arc(p.x, p.y, 6, 0, Math.PI*2);
                ctx.fill();
                // Barra HP Steve
                ctx.fillStyle = "red"; ctx.fillRect(p.x-6, p.y-9, 12, 2);
                ctx.fillStyle = "#76ff03"; ctx.fillRect(p.x-6, p.y-9, 12 * (p.hp/100), 2);
            });

            // Zombies
            data.zombies.forEach(z => {
                ctx.beginPath();
                ctx.fillStyle = "#1b5e20"; 
                ctx.arc(z.x, z.y, 7 + (z.tier * 2), 0, Math.PI*2);
                ctx.fill();
                ctx.strokeStyle = "red"; ctx.lineWidth = 1; ctx.stroke();
            });

            document.getElementById('dia').innerText = data.dia;
            document.getElementById('threat').innerText = data.difficulty;
            document.getElementById('pob').innerText = data.steves.length;
            document.getElementById('zom').innerText = data.zombies.length;
        }

        async function loop() {
            try {
                const response = await fetch('/data'); 
                if (response.ok) draw(await response.json());
            } catch(e) {}
            setTimeout(loop, 50); 
        }

        document.getElementById('slider').oninput = async function() {
            await fetch('/speed', { method: 'POST', body: JSON.stringify({val: this.value}) });
        };
        loop();
    </script>
</body>
</html>
