
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>PC4: Agentes Evolutivos</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1e1e1e; color: #eee; text-align: center; }
        canvas { background: #2b2b2b; border: 2px solid #444; box-shadow: 0 4px 10px rgba(0,0,0,0.5); margin-top: 15px; }
        .panel { background: #333; padding: 15px; display: inline-block; border-radius: 12px; border: 1px solid #555; }
        input[type=range] { vertical-align: middle; }
    </style>
</head>
<body>
    <h1>Simulaci√≥n de Selecci√≥n Natural (PC4)</h1>

    <div class="panel">
        <span>üìÖ D√≠a: <b id="dia">0</b></span> | 
        <span>üß¨ Poblaci√≥n: <b id="pob">0</b></span> | 
        <span>üçî Comida: <b id="food">0</b></span>
        <br><br>
        <label>‚ö° Velocidad Simulaci√≥n:</label>
        <input type="range" id="slider" min="1" max="20" value="1">
    </div>

    <br>
    <canvas id="simCanvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const ANCHO = 800, ALTO = 600;

        function draw(data) {
            ctx.clearRect(0, 0, ANCHO, ALTO);

            // 1. Dibujar Zonas de "Hogar" (Safe Zones)
            ctx.fillStyle = "rgba(65, 105, 225, 0.15)"; // RoyalBlue transparente
            ctx.fillRect(0, 0, 60, ALTO); // Izquierda
            ctx.fillRect(ANCHO - 60, 0, 60, ALTO); // Derecha

            // Texto de zonas
            ctx.fillStyle = "rgba(255, 255, 255, 0.3)";
            ctx.font = "20px Arial";
            ctx.fillText("CASA", 5, 300);
            ctx.fillText("CASA", ANCHO - 55, 300);

            // 2. Dibujar Comida
            data.comida.forEach(c => {
                ctx.fillStyle = "#00ff7f"; // SpringGreen
                ctx.beginPath(); ctx.arc(c.x, c.y, 4, 0, Math.PI*2); ctx.fill();
            });

            // 3. Dibujar Agentes Blob
            data.blobs.forEach(b => {
                ctx.beginPath();
                // Visualizaci√≥n de Evoluci√≥n: Color depende de velocidad
                // Velocidad base ~2.0. Rango visual: 0.5 (Azul) a 5.0 (Rojo)
                let normSpeed = Math.max(0, Math.min(1, (b.speed - 0.5) / 4.0));
                let r = Math.floor(255 * normSpeed);
                let g = 0;
                let blue = Math.floor(255 * (1 - normSpeed));

                ctx.fillStyle = (b.state === 'seguro') ? '#888' : `rgb(${r}, ${g}, ${blue})`;
                ctx.arc(b.x, b.y, 9, 0, Math.PI*2);
                ctx.fill();

                // Borde para distinguir
                ctx.strokeStyle = "#fff";
                ctx.lineWidth = 1;
                ctx.stroke();
            });

            // Actualizar Panel
            document.getElementById('dia').innerText = data.dia;
            document.getElementById('pob').innerText = data.blobs.length;
            document.getElementById('food').innerText = data.comida.length;
        }

        async function loop() {
            try {
                // Comunicaci√≥n con el Agente Central
                const response = await fetch('/data'); 
                if (response.ok) {
                    const data = await response.json();
                    draw(data);
                }
            } catch(e) { console.log("Sincronizando con Agente Central..."); }
            setTimeout(loop, 80); // ~12 FPS en GUI
        }

        document.getElementById('slider').oninput = async function() {
            await fetch('/speed', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({val: this.value})
            });
        };

        loop();
    </script>
</body>
</html>
